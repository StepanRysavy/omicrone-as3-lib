package com.omicrone {		import com.hurlant.util.Base64;		import flash.display.Bitmap;	import flash.display.Loader;	import flash.events.DataEvent;	import flash.events.Event;	import flash.events.EventDispatcher;	import flash.events.IOErrorEvent;	import flash.events.ProgressEvent;	import flash.net.FileFilter;	import flash.net.FileReference;	import flash.net.URLRequest;	import flash.utils.ByteArray;		public class ImageFakeUpload extends EventDispatcher {				private var _uploadURL:URLRequest;		private var _file:FileReference;		private var _imageTypes:FileFilter;		private var _bitmap:Bitmap;		private var _loader:Loader;		private var _lastURL:String = "";		private var _target;				//private var _image:MetaImage;				public function ImageFakeUpload(url:String, targetMC = null) {			//Log.add ("vytvářím fake soubor a nahrávám na server", this);							_target = targetMC;						_uploadURL = new URLRequest ();			_uploadURL.url = url;			_imageTypes = new FileFilter("Obrázky (*.jpg, *.jpeg, *.gif, *.png)","*.jpg; *.jpeg; *.gif; *.png");						//_image = new MetaImage (0, "", "", false, false, targetMC);		}				public function select () {						//Log.add("výběr souboru", this);						_file = new FileReference();			_file.addEventListener (Event.SELECT, selectHandler);			_file.addEventListener (IOErrorEvent.IO_ERROR, ioErrorHandler);			_file.addEventListener (ProgressEvent.PROGRESS, progressHandler);			_file.addEventListener (DataEvent.UPLOAD_COMPLETE_DATA, uploadDataComplete);						_file.browse (new Array(_imageTypes));		}		/**		public function get image ():MetaImage {			return _image;		}		*/		private function uploadDataComplete (event:DataEvent):void {						trace (event.data);						//Log.add ("soubor byl načten na server", this);						//_loader = _image.loader;			_loader = new Loader ();			var ba:ByteArray = new ByteArray();			ba.writeBytes (Base64.decodeToByteArray(event.data));									//_loader.contentLoaderInfo.addEventListener (Event.COMPLETE, getBitmapData);			_loader.contentLoaderInfo.addEventListener (ProgressEvent.PROGRESS, progressHandler2);						_loader.loadBytes (ba);		}				private function selectHandler (event:Event):void {						Log.add("začíná nahrávání na server", this);						_lastURL = _file.name;			_file.upload (_uploadURL);		}				private function ioErrorHandler (event:IOErrorEvent):void {			Log.add("ERROR: IO chyba", this);		}				private function progressHandler (event:ProgressEvent):void {			Log.add ("nahráno: " + parseInt((event.bytesLoaded / 1024).toString()) + " KB", this);		}				private function progressHandler2 (event:ProgressEvent):void {			Log.add ("nahráno: " + parseInt((_loader.contentLoaderInfo.bytesLoaded / 1024).toString()) + "/" + parseInt((_loader.contentLoaderInfo.bytesTotal / 1024).toString()) + " KB", this);		}				/**		private function getBitmapData (e:Event):void {			_image.loaded();			_image.load (_target);		}		 */	}}